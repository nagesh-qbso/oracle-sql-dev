CREATE OR REPLACE VIEW VIEW_VENDOR_SOA_TRANS AS
SELECT L.LOCATION_MST_PK,
        L.LOCATION_NAME,
        V.VENDOR_MST_PK,
        V.VENDOR_ID,
        V.VENDOR_NAME,
        D.DA_VOUCHER_DT REF_DATE,
        'V. INVOICE' TRANCACTION,
        D.DA_VOUCHER_REF_NO DOC_REF_NO,
        DT.ROEAMT DEBIT,
        /*(SELECT LQH.LIQUIDATION_REF_NO
           FROM LIQUIDATION_HDR LQH, LIQUIDATION_DTL LQD
          WHERE LQH.LIQUIDATION_HDR_PK = LQD.LIQUIDATION_HDR_FK
            AND LQD.DA_VOUCHER_DTL_FK = DT.DA_VOUCHER_TRN_PK) LIQUIDATION_REF_NO,
        (SELECT NVL(DT.ROEAMT, 0)
           FROM LIQUIDATION_DTL LD
          WHERE LD.DA_VOUCHER_DTL_FK = DT.DA_VOUCHER_TRN_PK) CREDIT,*/
          '' LIQUIDATION_REF_NO,
          null CREDIT,
        0 BALANCE,
        '' GROUPID,
        L.COUNTRY_MST_FK,
        D.VENDOR_TYPE_FK VENDOR_TYPE_MST_FK,
        /*(SELECT CURR.CURRENCY_MST_PK
           FROM LOCATION_MST_TBL      LOC,
                COUNTRY_MST_TBL       C,
                CURRENCY_TYPE_MST_TBL CURR
          WHERE LOC.COUNTRY_MST_FK = C.COUNTRY_MST_PK
            AND C.CURRENCY_MST_FK = CURR.CURRENCY_MST_PK
            AND LOC.LOCATION_MST_PK = D.LOCATION_MST_FK) CURRENCY_MST_FK,*/
        D.CUR_MST_FK CURRENCY_MST_FK,
        D.DA_VOUCHER_HDR_PK,
        L.QILS_LOCATION_MST_FK LOCATION_MST_FK,
        D.CREATED_DATE,
        D.LINE_MST_FK,
        C.CARRIER_ID,
        C.CARRIER_NAME,
        d.invoice_no
   FROM VENDOR_MST_TBL   V,
        LOCATION_MST_TBL L,
        DA_VOUCHER_HDR   D,
        DA_VOUCHER_DTL   DT,
        CARRIER_MST_TBL  C
  WHERE D.LOCATION_MST_FK  = L.LOCATION_MST_PK
    AND D.VENDOR_MST_FK = V.VENDOR_MST_PK
    AND D.DA_VOUCHER_HDR_PK = DT.DA_VOUCHER_HDR_FK
    AND C.CARRIER_MST_PK(+)= D.LINE_MST_FK
    AND D.STATUS =2
    UNION
    SELECT L.LOCATION_MST_PK,
        L.LOCATION_NAME,
        V.VENDOR_MST_PK,
        V.VENDOR_ID,
        V.VENDOR_NAME,
        D.DA_VOUCHER_DT REF_DATE,
        'V. INVOICE CANCEL' TRANCACTION,
        D.DA_VOUCHER_REF_NO DOC_REF_NO,
        -DT.ROEAMT DEBIT,
        '' LIQUIDATION_REF_NO,
        null CREDIT,
        0 BALANCE,
        '' GROUPID,
        L.COUNTRY_MST_FK,
        D.VENDOR_TYPE_FK VENDOR_TYPE_MST_FK,
        D.CUR_MST_FK CURRENCY_MST_FK,
        D.DA_VOUCHER_HDR_PK,
        L.QILS_LOCATION_MST_FK LOCATION_MST_FK,
        D.CREATED_DATE + 0.001 CREATED_DATE,
        D.LINE_MST_FK,
        C.CARRIER_ID,
        C.CARRIER_NAME,
        d.invoice_no
   FROM VENDOR_MST_TBL   V,
        LOCATION_MST_TBL L,
        DA_VOUCHER_HDR   D,
        DA_VOUCHER_DTL   DT,
        CARRIER_MST_TBL  C
  WHERE D.LOCATION_MST_FK  = L.LOCATION_MST_PK
    AND D.VENDOR_MST_FK = V.VENDOR_MST_PK
    AND C.CARRIER_MST_PK(+)= D.LINE_MST_FK
    AND D.DA_VOUCHER_HDR_PK = DT.DA_VOUCHER_HDR_FK
    AND D.STATUS =3
    UNION
    SELECT L.LOCATION_MST_PK,
        L.LOCATION_NAME,
        V.VENDOR_MST_PK,
        V.VENDOR_ID,
        V.VENDOR_NAME,
        PMT.PAYMENT_DATE REF_DATE,
        'PAYMENT' TRANCACTION,
        '' DOC_REF_NO,
        null DEBIT,
        PMT.PAYMENT_REF_NR LIQUIDATION_REF_NO,
        PDT.RECEIVED_AMT CREDIT,
        0 BALANCE,
        '' GROUPID,
        L.COUNTRY_MST_FK,
        D.VENDOR_TYPE_FK VENDOR_TYPE_MST_FK,
        PDT.CUR_MST_FK CURRENCY_MST_FK,
        PMT.PAYMENT_MST_PK DA_VOUCHER_HDR_PK,
        L.QILS_LOCATION_MST_FK LOCATION_MST_FK,
        D.CREATED_DATE + 0.002 CREATED_DATE,
        PMT.LINE_MST_FK,
        C.CARRIER_ID,
        C.CARRIER_NAME,
        d.invoice_no
   FROM VENDOR_MST_TBL   V,
        LOCATION_MST_TBL L,
        DA_VOUCHER_HDR   D,
        --DA_VOUCHER_DTL   DT,
        PAYMENT_MST_TBL  PMT,
        PAYMENT_DTL_TBL  PDT,
        CARRIER_MST_TBL  C
  WHERE D.LOCATION_MST_FK  = L.LOCATION_MST_PK
    AND D.VENDOR_MST_FK = V.VENDOR_MST_PK
    --AND D.DA_VOUCHER_HDR_PK = DT.DA_VOUCHER_HDR_FK
    AND D.DA_VOUCHER_HDR_PK = PDT.REFERENCE_MST_FK
    AND PDT.PAYMENT_MST_FK=PMT.PAYMENT_MST_PK
    AND C.CARRIER_MST_PK(+)= D.LINE_MST_FK
    AND D.STATUS in (2, 4)
    AND PMT.STATUS=2;
